pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

game_state = {
    splash = 0,
    playing = 1,
    fail = 2,
    landed = 3
}

direction = {
    vertical = 0,
    left = 1,
    right = 2
}

diver_size = 16 -- width and height of the diver 
target_width = 8 -- width of the target
crow_frames = {32, 40}
crow_current_frame = 1
crow_animation_speed = 0.1

-- returns true if two rectangles overlap at all
-- x1, y1, w1, h1 are the first rectangle's top left x, top left y, width, and height
-- x2, y2, w2, h2 are the second rectangle's top left x, top left y, width, and height
function check_collision(x1, y1, w1, h1, x2, y2, w2, h2)
    return x1 < x2 + w2 and
           x2 < x1 + w1 and
           y1 < y2 + h2 and
           y2 < y1 + h1
end

-- prints text centered horizontally
function print_centered(text, y, color)
    local x = (128 - #text * 4) / 2
    print(text, x, y, color)
end

function clear_table(t)
    for k in pairs(t) do
        t[k] = nil
    end
end

function reset()
    diver_x = flr(rnd()*128)
    diver_y = 0
    crow_x = 32
    crow_y = 32
    target = flr(rnd()*120)
    target_direction = rnd() > 0.5 and 1 or -1
    current_state = game_state.playing
    diver_direction = direction.vertical
    crow_current_frame = 1
    crow_animation_speed = 0.5
end

function _init()
	music(0)
    current_state = game_state.splash
end

function _update()
    if current_state ~= game_state.playing then
        if btn(4) then
            reset()
        end
        return
    end

    crow_current_frame += crow_animation_speed
    if crow_current_frame > #crow_frames + 1 then
        crow_current_frame = 1
    end

    diver_y += 1
	if btn(0) then 
        diver_x -= 1 
        diver_direction = direction.left
    elseif btn(1) then 
        diver_x += 1 
        diver_direction = direction.right
    else
        diver_direction = direction.vertical
    end
    
    if diver_y > 128 - diver_size then
        if check_collision(diver_x, diver_y, diver_size, diver_size,
                        target, 127, target_width, 1) then
            current_state = game_state.landed
        else
            current_state = game_state.fail
        end
        
        diver_y = 127 - diver_size
    end

    target += 0.9*target_direction
    if target < 0 or target > 120 then
        target_direction *= -1
    end

end

function _draw()
	cls()
    if current_state == game_state.splash then
        print_centered("skydiver!", 30, 7)
        print_centered("n: new game", 50, 7)
        print_centered("move left and right", 70, 7)
        print_centered("to hit the target!", 80, 7)
        print_centered("avoid the crows!", 100, 7)
        return
    else
        spr(crow_frames[flr(crow_current_frame)], crow_x, crow_y, 8, 8)

        rect(target, 127, target + target_width, 127, 7)
        if current_state == game_state.fail then
            print_centered("too bad", 64, 9)
        elseif current_state == game_state.landed then
            print_centered("landed", 64, 9)
        end

    	if diver_direction == direction.vertical then
            spr(0, diver_x, diver_y, 2, 2)
        elseif diver_direction == direction.left then
            spr(4, diver_x, diver_y, 2, 2)
        elseif diver_direction == direction.right then
            spr(2, diver_x, diver_y, 2, 2)
        end

    end
end

__gfx__
00000777777000000000077777700000000007777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007771dd17770000007771dd17770000007771dd177700000000000000000000000000000000000000000000000000000000000000000000000000000000000
0071dd1dd1dd17000071dd1dd1dd17000071dd1dd1dd170000000000000000000000000000000000000000000000000000000000000000000000000000000000
07dd1d1dd1d1dd7007dd1d1dd1d1dd7007dd1d1dd1d1dd7000000000000000000000000000000000000000000000000000000000000000000000000000000000
71111111111111177111111111111117711111111111111700000000000000000000000000000000000000000000000000000000000000000000000000000000
7cccccccccccccc77cccccccccccccc77cccccccccccccc700000000000000000000000000000000000000000000000000000000000000000000000000000000
07ccccc77ccccc7007cc77cccccccc7007cccccccc77cc7000000000000000000000000000000000000000000000000000000000000000000000000000000000
007ccc7337ccc70007c7337ccccc77000077ccccc7337c7000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007cc7777cc700007c7777ccc770000000077ccc7777c7000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007cc77cc70000007c77cc7700000000000077cc77c70000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000776677000000077667700000000000000007766770000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000002200000000000220000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000002200000000000022000000000000000000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000002200000000000002200000000000000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000002200000000000000220000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000088880000000000008888000000000000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000888888800000000000000000000000000000008888880000000000
000000000000000000000000000000000000000000000000000000000000000000000000088eeeee888000000000000000000000000008888eeee88800000000
00000000000000000000000000000000000000000000000000000000000000000000000088eeeeeeee8880000000000000000000008888eeeeeeeee880000000
0000000000000000000000000000000000000000000000000000000000000000000000088eeeeeeeeeee88800000000000000000088eeeeeeeeeeeee88800000
000000000000000000000000000000000000000000000000000000000000000000000088eeeeeeeeeeeeee88000000000000000088eeeeeeeeeeeeeeee800000
00000000000000000000000000000000000000000000000000000000000000000000088eeeeeeeeeeeeeeee800000000000000088eeeeeeeeeeeeeeeee880000
0000000000000000000000000000000000000000000000000000000000000000000008eeeeeeeeeeeeeeeeee8000000000000008eeeeeeeeeeeeeeeeeee88000
000000000000000000000000000000000000000000000000000000000000000000008eeeeeeeeeeeeeeeeeee8800000000000088eeeeeeeeeeeeeeeeeeee8000
000000000000000000000000000000000000000000000000000000000000000000088eeeeeeeeeeeeeeeeeeee80000000000008eeeeeeeeeeeeeeeeeeeee8000
00000000000000000000000000000000000000000000000000000000000000000008eeeeeeeeeeeeeeeeeeeee88000000000088eeeeeeeeeeeeeeeeeeeeee800
0000000000000000000000000000000000000000000000000000000000000000008eeeeee8888888888eeeeeee800000000008eeeeeeeeeeeeeeeeeeeeeee800
0000000000000000000000000000000000000000000000000000000000000000008eeeee8800000000888eeeee880000000008eeeeeeeeeeeeeeeeeeeeeee880
000000000000000000000000000000000000000000000000000000000000000008eeee88800000000000888eeee80000000088eeeeeeeeee8888888eeeeeee80
000000000000000000000000000000000000000000000000000000000000000008ee88800000000000000088eee8000000008eeeeeeeee88800000888eeeee88
000000000000000000000000000000000000000000000000000000000000000008e8800000000000000000008e1800888888888eeeee88800000000088eeeee8
000000000088888880000000000000000000000000000000888888000000000008880000000000000000000008088880000000088ee88000000000000888eee8
00000000088eeeee888000000000000000000000000008888eeee88800000000000000000000000000000000008800000000000088e8000000000000000888e8
0000000088eeeeeeee8880000000000000000000008888eeeeeeeee88000000000000000000000000000000008800000000cc000008000000000000000000888
000000088eeeeeeeeeee88800000000000000000088eeeeeeeeeeeee888000000000000000000000000000000800ccc0000cc000008000000000000000000000
00000088eeeeeeeeeeeeee88000000000000000088eeeeeeeeeeeeeeee8000000000000000000000000000008800ccc0000cc000008000000000000000000000
0000088eeeeeeeeeeeeeeee800000000000000088eeeeeeeeeeeeeeeee8800000000000000000000000000008000000000000000008000000000000000000000
000008eeeeeeeeeeeeeeeeee8000000000000008eeeeeeeeeeeeeeeeeee880000000000000000000000000008000000000000000008000000000000000000000
00008eeeeeeeeeeeeeeeeeee8800000000000088eeeeeeeeeeeeeeeeeeee80000000000000000000000000008000000000000000008000000000000000000000
00088eeeeeeeeeeeeeeeeeeee80000000000008eeeeeeeeeeeeeeeeeeeee8000000000000000000000000000800000aaaaaaaa00008000000000000000000000
0008eeeeeeeeeeeeeeeeeeeee88000000000088eeeeeeeeeeeeeeeeeeeeee8000000000000000000000000008800000aa0aa0000008000000000000000000000
008eeeeee8888888888eeeeeee800000000008eeeeeeeeeeeeeeeeeeeeeee80000000000000000000000000008800000aaa00000088000000000000000000000
008eeeee8800000000888eeeee880000000008eeeeeeeeeeeeeeeeeeeeeee88000000000000000000000000000880000aa000000880000000000000000000000
08eeee88800000000000888eeee80000000088eeeeeeeeee8888888eeeeeee800000000000000000000000000008880000000081100000000000000000000000
08ee88800000000000000088eee8000000008eeeeeeeee88800000888eeeee880000000000000000000000000011008888888800110000000000000000000000
08e8800000000000000000008e1800888888888eeeee88800000000088eeeee80000000000000000000000000110000000000000011000000000000000000000
08880000000000000000000008088880000000088ee88000000000000888eee80000000000000000000000000100000000000000001000000000000000000000
000000000000000000000000008800000000000088e8000000000000000888e80000000000000000000000001100000000000000000100000000000000000000
00000000000000000000000008800000000cc0000080000000000000000008880000000000000000000000001000000000000000000010000000000000000000
0000000000000000000000000800ccc0000cc0000080000000000000000000000000000000000000000000010000000000000000000010000000000000000000
0000000000000000000000008800ccc0000cc0000080000000000000000000000000000000000000000000010000000000000000000001000000000000000000
00000000000000000000000080000000000000000080000000000000000000000000000000000000000000110000000000000000000001100000000000000000
00000000000000000000000080000000000000000080000000000000000000000000000000000000000001100000000000000000000000100000000000000000
00000000000000000000000080000000000000000080000000000000000000000000000000000000000001000000000000000000000000110000000000000000
000000000000000000000000800000aaaaaaaa000080000000000000000000000000000000000000000111000000000000000000000000011000000000000000
0000000000000000000000008800000aa0aa00000080000000000000000000000000000000000000001111000000000000000000000000111100000000000000
00000000000000000000000008800000aaa000000880000000000000000000000000000000000011111101100000000000000000000000110011110000000000
00000000000000000000000000880000aa0000008800000000000000000000000000000000000100011000100000000000000000000001010000011100000000
00000000000000000000000000088800000000811000000000000000000000000000000000011000010000110000000000000000000010010000000110000000
00000000000000000000000000110088888888001100000000000000000000000000000000000000100000001000000000000000000110010000000000000000
00000000000000000000000001100000000000000110000000000000000000000000000000000001100000001100000000000000001100011000000000000000
00000000000000000000000001000000000000000010000000000000000000000000000000000001000000000110000000000000011000001000000000000000
00000000000000000000000011000000000000000001000000000000000000000000000000000001000000000000000000000000010000000000000000000000
00000000000000000000000010000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000100000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000100000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001100000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000011000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000010000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000001110000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000011110000000000000000000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000111111011000000000000000000000001100111100000000000000000000000000000000000000000000000000000000000000000000000000
00000000000001000110001000000000000000000000010100000111000000000000000000000000000000000000000000000000000000000000000000000000
00000000000110000100001100000000000000000000100100000001100000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001000000010000000000000000001100100000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000011000000011000000000000000011000110000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000010000000001100000000000000110000010000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000010000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
9f0f00002b0242b0202b0202b0202b0202b0202b0202b020270202702024020240202402024020220202202024020240202202022020240202402027020270202702027020270202702027020270201d0001d000
070f00200007515005000750007500075000050007500075000751500500075000750007500005000750007500075150050007500075000750000500075000750007515005000750007500075000050007500075
d70f00200c3250f32513325163250c3250f32513325163250c3250f32513325163250c3250f32513325163250c3250f32513325163250c3250f32513325163250c3250f32513325163250c3250f3251332516325
9f0f00202b0242b0202b0202b0202b0202b0202b0202b02027020270202402024020240202402024025220002400024000332443324032244322402e2442e2402c2442c240312443124030244302402c2442c240
010f00200007515005000750007500075000050007500075000751500500075000750007500005000750007503075150050307503075080750000508075080750107515005010750107506075000050607506075
4d0f00200c3250f32513325163250c3250f32513325163250c3250f32513325163250c3250f32513325163250f32513325163251a32514325183251b3251f3250d3251132514325183251232516325193251d325
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00f0020006753f6053f6153f60529635296053f61532605006753f6053f6153f60529635296053f6153b625006753f6053f6153f60529635296053f61532605006753f6053f6153f60529635296053f6153b625
__music__
00 0a400102
00 0a420102
01 0a000102
02 0a030405
02 4a424445

